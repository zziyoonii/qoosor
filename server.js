const express = require('express');
const cors = require('cors');
const axios = require('axios');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 3001;

// ë¯¸ë“¤ì›¨ì–´
app.use(cors());
app.use(express.json());

// AI API ë³€í™˜ ì—”ë“œí¬ì¸íŠ¸ (ëª©ì—… ë²„ì „)
app.post('/api/gpt', async (req, res) => {
  try {
    const { input, tone } = req.body;

    if (!input) {
      return res.status(400).json({ error: 'ì…ë ¥ í…ìŠ¤íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.' });
    }

    // ğŸ’¡ ëª©ì—… ì‘ë‹µ ë¡œì§
    const mockResponses = {
      ê¸°ë³¸: {
        'ì‹œìŠ¤í…œ ì ê²€': 'ì§€ê¸ˆì€ ì•ˆì •ì ìœ¼ë¡œ ì ‘ì†í•  ìˆ˜ ìˆì–´ìš”. ê°™ì€ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šë„ë¡ ì¶”ê°€ í™•ì¸ë„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤!',
        'ì„œë²„ ì˜¤ë¥˜': 'ì‹œìŠ¤í…œì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆì—ˆëŠ”ë°, ì§€ê¸ˆì€ í•´ê²°í•´ë“œë ¸ì–´ìš”. ì•ˆì •ì ìœ¼ë¡œ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        'API ì˜¤ë¥˜': 'ì™¸ë¶€ ì„œë¹„ìŠ¤ì™€ì˜ ì—°ê²°ì— ì ê¹ ë¬¸ì œê°€ ìˆì—ˆëŠ”ë°, ì§€ê¸ˆì€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆì–´ìš”.',
        'ë°ì´í„°ë² ì´ìŠ¤': 'ì •ë³´ ì²˜ë¦¬ì— ì ê¹ ì§€ì—°ì´ ìˆì—ˆëŠ”ë°, ì§€ê¸ˆì€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆì–´ìš”.',
        'íƒ€ì„ì•„ì›ƒ': 'ì²˜ë¦¬ ì‹œê°„ì´ ì˜ˆìƒë³´ë‹¤ ì˜¤ë˜ ê±¸ë ¸ëŠ”ë°, ì§€ê¸ˆì€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆì–´ìš”.',
        'ê¸°ë³¸': 'ìš”ì²­í•˜ì‹  ë‚´ìš©ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì ê¹ ë¬¸ì œê°€ ìˆì—ˆëŠ”ë°, ì§€ê¸ˆì€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆì–´ìš”.'
      },
      ì •ì¤‘í˜•: {
        'ì‹œìŠ¤í…œ ì ê²€': 'ì ‘ì† ì˜¤ë¥˜ëŠ” ì¸ì¦ì´ ì¼ì‹œì ìœ¼ë¡œ ë§Œë£Œë˜ì–´ ë°œìƒí•œ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì´ìš© ê°€ëŠ¥í•˜ì‹œë©°, ì¬ë°œ ë°©ì§€ë¥¼ ìœ„í•œ ì ê²€ë„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.',
        'ì„œë²„ ì˜¤ë¥˜': 'ì„œë²„ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ë°œìƒí•œ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì´ìš© ê°€ëŠ¥í•˜ì‹œë©°, ì¬ë°œ ë°©ì§€ë¥¼ ìœ„í•œ ì ê²€ë„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.',
        'API ì˜¤ë¥˜': 'ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆì—ˆë˜ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
        'ë°ì´í„°ë² ì´ìŠ¤': 'ì •ë³´ ì²˜ë¦¬ì— ì¼ì‹œì ì¸ ì§€ì—°ì´ ìˆì—ˆë˜ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
        'íƒ€ì„ì•„ì›ƒ': 'ì²˜ë¦¬ ì‹œê°„ì´ ì˜ˆìƒë³´ë‹¤ ì˜¤ë˜ ê±¸ë ¸ë˜ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
        'ê¸°ë³¸': 'ìš”ì²­í•˜ì‹  ë‚´ìš©ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆì—ˆë˜ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.'
      },
      ê³µê°í˜•: {
        'ì‹œìŠ¤í…œ ì ê²€': 'êµ¬ë¦„ ì´ìš©ì— ë¶ˆí¸ì„ ë“œë ¤ ì£„ì†¡í•©ë‹ˆë‹¤. ì ‘ì† ì˜¤ë¥˜ëŠ” ì¸ì¦ì´ ì¼ì‹œì ìœ¼ë¡œ ëŠê²¨ ë°œìƒí•œ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆê³ , ì§€ê¸ˆì€ ì•ˆì •ì ìœ¼ë¡œ ì´ìš© ê°€ëŠ¥í•˜ì‹­ë‹ˆë‹¤. ê°™ì€ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šë„ë¡ ì¶”ê°€ í™•ì¸ë„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.',
        'ì„œë²„ ì˜¤ë¥˜': 'ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì˜¤ë¥˜ë¡œ ë‹¹í™©í•˜ì…¨ì„ ê²ƒ ê°™ì•„ìš”. ì‹œìŠ¤í…œì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆì—ˆëŠ”ë°, ì§€ê¸ˆì€ í•´ê²°í•´ë“œë ¸ìŠµë‹ˆë‹¤. ê°™ì€ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šë„ë¡ ì¶”ê°€ í™•ì¸ë„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.',
        'API ì˜¤ë¥˜': 'ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°ì— ë¬¸ì œê°€ ìˆì–´ì„œ ë¶ˆí¸í•˜ì…¨ê² ì–´ìš”. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìœ¼ë‹ˆ ì•ˆì‹¬í•˜ì„¸ìš”. ê°™ì€ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šë„ë¡ ì¶”ê°€ í™•ì¸ë„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.',
        'ë°ì´í„°ë² ì´ìŠ¤': 'ì •ë³´ ì²˜ë¦¬ì— ì§€ì—°ì´ ìˆì–´ì„œ ë‹µë‹µí•˜ì…¨ì„ ê²ƒ ê°™ì•„ìš”. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê°™ì€ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šë„ë¡ ì¶”ê°€ í™•ì¸ë„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.',
        'íƒ€ì„ì•„ì›ƒ': 'ì²˜ë¦¬ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë ¤ì„œ ë¶ˆí¸í•˜ì‹œê² ì–´ìš”. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë” ë¹ ë¥´ê²Œ ê°œì„ í•´ë“œë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.',
        'ê¸°ë³¸': 'ì´ìš© ì¤‘ ë¶ˆí¸ì„ ë“œë ¤ì„œ ì •ë§ ì£„ì†¡í•©ë‹ˆë‹¤. í˜„ì¬ëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìœ¼ë‹ˆ ì•ˆì‹¬í•˜ì„¸ìš”. ê°™ì€ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šë„ë¡ ì¶”ê°€ í™•ì¸ë„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.'
      },
      ê°„ê²°í˜•: {
        'ì‹œìŠ¤í…œ ì ê²€': 'ì¸ì¦ì´ ì ì‹œ ëŠê²¨ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆê³ , ì§€ê¸ˆì€ ì •ìƒí™”ëœ ìƒíƒœì…ë‹ˆë‹¤.',
        'ì„œë²„ ì˜¤ë¥˜': 'ì„œë²„ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆì—ˆê³ , ì§€ê¸ˆì€ ì •ìƒí™”ëœ ìƒíƒœì…ë‹ˆë‹¤.',
        'API ì˜¤ë¥˜': 'ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°ì— ë¬¸ì œê°€ ìˆì—ˆê³ , ì§€ê¸ˆì€ ì •ìƒí™”ëœ ìƒíƒœì…ë‹ˆë‹¤.',
        'ë°ì´í„°ë² ì´ìŠ¤': 'ì •ë³´ ì²˜ë¦¬ì— ì§€ì—°ì´ ìˆì—ˆê³ , ì§€ê¸ˆì€ ì •ìƒí™”ëœ ìƒíƒœì…ë‹ˆë‹¤.',
        'íƒ€ì„ì•„ì›ƒ': 'ì²˜ë¦¬ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆê³ , ì§€ê¸ˆì€ ì •ìƒí™”ëœ ìƒíƒœì…ë‹ˆë‹¤.',
        'ê¸°ë³¸': 'ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆì—ˆê³ , ì§€ê¸ˆì€ ì •ìƒí™”ëœ ìƒíƒœì…ë‹ˆë‹¤.'
      }
    };

    // ì…ë ¥ í…ìŠ¤íŠ¸ì—ì„œ í‚¤ì›Œë“œ ì°¾ê¸°
    const findKeyword = (text) => {
      const keywords = ['ì‹œìŠ¤í…œ ì ê²€', 'ì„œë²„ ì˜¤ë¥˜', 'API ì˜¤ë¥˜', 'ë°ì´í„°ë² ì´ìŠ¤', 'íƒ€ì„ì•„ì›ƒ'];
      for (const keyword of keywords) {
        if (text.includes(keyword)) {
          return keyword;
        }
      }
      return 'ê¸°ë³¸';
    };

    const keyword = findKeyword(input);
    const toneResponses = mockResponses[tone] || mockResponses['ê¸°ë³¸'];
    const result = toneResponses[keyword] || toneResponses['ê¸°ë³¸'];

    res.json({
      result,
      originalText: input,
      tone: tone || 'ê¸°ë³¸',
      timestamp: new Date().toISOString(),
      note: 'ëª©ì—… ì‘ë‹µì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.'
    });

  } catch (error) {
    console.error('ëª©ì—… API ì˜¤ë¥˜:', error);

    // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ ë³€í™˜ ë¡œì§ ì‚¬ìš©
    const basicTransformation = performBasicTransformation(req.body.text);

    res.json({
      transformedText: basicTransformation,
      originalText: req.body.text,
      tone: req.body.tone || 'ê¸°ë³¸',
      timestamp: new Date().toISOString(),
      note: 'ì˜¤ë¥˜ ë°œìƒìœ¼ë¡œ ê¸°ë³¸ ë³€í™˜ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.'
    });
  }
});

// ê¸°ë³¸ ë³€í™˜ ë¡œì§ (AI API ì‹¤íŒ¨ ì‹œ í´ë°±)
function performBasicTransformation(text) {
  let transformed = text;

  // ê¸°ë³¸ì ì¸ ê¸°ìˆ  ìš©ì–´ ë³€í™˜
  const basicReplacements = {
    'API': 'API(ì™¸ë¶€ ì—°ë™ ê¸°ëŠ¥)',
    'SDK': 'SDK(ê°œë°œ ë„êµ¬)',
    'ì„œë²„': 'ì„œë²„(ì‹œìŠ¤í…œ)',
    'ë°ì´í„°ë² ì´ìŠ¤': 'ë°ì´í„°ë² ì´ìŠ¤(ì •ë³´ ì €ì¥ì†Œ)',
    'ë²„ê·¸': 'ë¬¸ì œ',
    'ë°°í¬': 'ì ìš©',
    'ë¼ì´ë¸ŒëŸ¬ë¦¬': 'ê¸°ëŠ¥ ëª¨ìŒ',
    'í”„ë ˆì„ì›Œí¬': 'ê°œë°œ ë„êµ¬',
    'íŒŒì´ì¬': 'Python',
    'ìë°”': 'Java',
    'ìë°”ìŠ¤í¬ë¦½íŠ¸': 'JavaScript'
  };

  Object.entries(basicReplacements).forEach(([term, replacement]) => {
    const regex = new RegExp(`\\b${term}\\b`, 'gi');
    transformed = transformed.replace(regex, replacement);
  });

  return transformed;
}

// ë£¨íŠ¸ ì£¼ì†Œ ì‘ë‹µ
app.get('/', (req, res) => {
  res.send('ğŸ¤– qooì˜ CX ë¶„ì‹  ì„œë²„ê°€ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤!');
});

// í—¬ìŠ¤ ì²´í¬ API (í”„ë¡ íŠ¸/ëª¨ë‹ˆí„°ë§ ìš©)
app.get('/api/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    timestamp: new Date().toISOString(),
    aiAvailable: !!process.env.OPENAI_API_KEY 
  });
});


app.listen(PORT, () => {
  console.log(`ì„œë²„ê°€ í¬íŠ¸ ${PORT}ì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.`);
  console.log(`AI API ìƒíƒœ: ${process.env.OPENAI_API_KEY ? 'ì‚¬ìš© ê°€ëŠ¥' : 'API í‚¤ ì—†ìŒ'}`);
}); 

// server.js

require('dotenv').config(); // .env íŒŒì¼ì„ ì½ì–´ì˜´

const apiKey = process.env.OPENAI_API_KEY;

console.log("ğŸ” ë‚´ API í‚¤:", apiKey);
